<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="icon" href="data:">
<title>電子署名体験ツール</title>
</head><body>
<h1>電子署名体験ツール</h1>
<main>
<section>
1. 公開鍵と秘密鍵を生成する<br>
<button id=btngen>公開鍵と秘密鍵を生成する</button><br>
<div>
<span>公開鍵</span><input id="inpubkey">
<span>秘密鍵</span><input id="inprikey">
</div>
</section>

<section>
2. 文章を書く<br>
<div>
<span>文章</span><textarea id="intext"></textarea>
</div>
</section>

<section>
3. 電子署名を生成する<br>
<button id=btnsign>電子署名を生成する</button><br>
<div>
<span>電子署名</span><textarea id="insign"></textarea>
<span>TrustQR</span><span id=qrspan></span>
</div>
</section>

<section>
4. 文章と電子署名と公開鍵を受け取る<br>
<button id=btncopy>上記の文書と電子署名と公開鍵をコピー</button><br>
<div>
<span>文章</span><textarea id="intext2"></textarea>
<span>電子署名</span><textarea id="insign2"></textarea>
</div>
</section>

<section>
5. 検証する<br>
<button id=btnverify>検証する</button><br>
<div>
<span>公開鍵</span><input id="inpubkey2">
<span>検証結果</span><input id="inverify">
</div>
</section>
  
</main>

<hr>
Lib: <a href=https://github.com/code4fukui/sec.js>sec.js</a><br>
<a href=https://github.com/code4fukui/hanko/>src on GitHub</a>
    

<script type="module">
import * as sec from "https://code4fukui.github.io/sec.js/sec.js";
import { QRCode } from "https://js.sabae.cc/QRCode.js";
import { coder } from "./coder.js";

btngen.onclick = async () => {
  const prikey = sec.prikey();
  const pubkey = sec.pubkey(prikey);
  inpubkey.value = coder.encode(pubkey);
  inprikey.value = coder.encode(prikey);
};
btnsign.onclick = async () => {
  const prikey = coder.decode(inprikey.value);
  const text = new TextEncoder().encode(intext.value);
  const sign = sec.sign(prikey, text);
  insign.value = inpubkey.value + coder.encode(sign);
  const url = location.href + "qr/#" + coder.encode(text) + insign.value;
  qrspan.innerHTML = "";
  const a = document.createElement("a");
  a.href = url;
  const qr = new QRCode(url);
  a.appendChild(qr);
  qrspan.appendChild(a);
};
btncopy.onclick = () => {
  intext2.value = intext.value;
  insign2.value = insign.value;
};
btnverify.onclick = async () => {
  const text = new TextEncoder().encode(intext2.value);
  const len = coder.encode(new Uint8Array(32)).length;
  const pubkey = coder.decode(insign2.value.substring(0, len));
  const sign = coder.decode(insign2.value.substring(len));
  const b = sec.verify(sign, pubkey, text);
  inpubkey2.value = coder.encode(pubkey);
  inverify.value = b ? "OK! 検証できました" : "エラー! 検証できませんでした";
};
</script>
<style>
body {
  font-family: sans-serif;
}
input {
  width: 100%;
}
textarea {
  width: 100%;
  height: 5em;
}
section {
  border: 2px solid #333;
  margin: 1em;
  padding: 1em;
}
section > * {
  margin: .3em 0;
}
section > div {
  display: grid;
  grid-template-columns: 5em 1fr;
  gap: .5em 0;
}
</style>

</body>
</html>

